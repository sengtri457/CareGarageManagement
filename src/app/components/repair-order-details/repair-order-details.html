<div *ngIf="order" class="container mt-4">
    <!-- Header -->
    <button routerLink="/repair-orders" class=" btn badge bg-info text-dark mb-4"><i class="bi bi-chevron-left"></i>
        &nbsp;Back</button>
    <div class="card shadow-sm mb-4">
        <div class="card">
            <div class="tools p-3 align-items-center ">
                <div class="wrapper-colors d-flex align-items-center">
                    <div class="circle">
                        <span class="red box pulse"></span>
                    </div>
                    <div class="circle">
                        <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                    </div>
                    <div class="circle">
                        <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                    </div>
                    <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
                </div>
            </div>
            <div class="card-body">
                <h2 class="card-title text-primary">Repair Order: {{ order.number }}</h2>
                <p class="mb-1"><strong>Status:</strong>
                    <span class="badge bg-info text-dark">{{ order.status }}</span>
                </p>
                <p class="mb-1"><strong>Total Cost:</strong> {{ order.totalCost | currency }}</p>
                <p class="mb-1"><strong>Date:</strong> {{ order.date | date:'medium' }}</p>
                <p><strong>Notes:</strong> {{ order.notes || 'N/A' }}</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Customer -->
        <div class="col-md-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="tools p-3 align-items-center ">
                    <div class="wrapper-colors d-flex align-items-center">
                        <div class="circle">
                            <span class="red box pulse"></span>
                        </div>
                        <div class="circle">
                            <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                        </div>
                        <div class="circle">
                            <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                        </div>
                        <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title text-secondary">Customer</h5>
                    <p class="mb-1"><strong>Name:</strong>
                        {{ order.customerId?.firstName }} {{order.customerId?.lastName}}</p>
                    <p class="mb-1"><strong>Phone:</strong> {{ order.customerId?.phone }}</p>
                    <p><strong>Email:</strong> {{ order.customerId?.email }}</p>
                    <p><strong>City:</strong> {{ order.customerId?.address.city }}</p>
                    <p><strong>Street:</strong> {{ order.customerId?.address.street }}</p>
                </div>
            </div>
        </div>

        <!-- Vehicle -->
        <div class="col-md-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="tools p-3 align-items-center ">
                    <div class="wrapper-colors d-flex align-items-center">
                        <div class="circle">
                            <span class="red box pulse"></span>
                        </div>
                        <div class="circle">
                            <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                        </div>
                        <div class="circle">
                            <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                        </div>
                        <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title text-secondary">Vehicle</h5>
                    <p class="mb-1">
                    <p class="mb-1"><strong>Year:</strong>{{ order.vehicleSnapshot?.year }}
                    <p class="mb-1"><strong>Make:</strong>{{ order.vehicleSnapshot?.make }}
                    <p class="mb-1"><strong>Models:</strong>{{ order.vehicleSnapshot?.model }}
                    </p>
                    <p class="mb-1"><strong>Plate:</strong> {{ order.vehicleSnapshot?.plate }}</p>
                    <p><strong>VIN:</strong> {{ order.vehicleSnapshot?.vin }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Mechanic -->
        <div class="col-md-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="tools p-3 align-items-center ">
                    <div class="wrapper-colors d-flex align-items-center">
                        <div class="circle">
                            <span class="red box pulse"></span>
                        </div>
                        <div class="circle">
                            <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                        </div>
                        <div class="circle">
                            <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                        </div>
                        <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title text-secondary">Mechanic</h5>
                    <p class="mb-1"><strong>FirstName:</strong> {{ order.mechanicSnapshot?.firstName }}</p>
                    <p class="mb-1"><strong>LastName:</strong> {{ order.mechanicSnapshot?.lastName }}</p>
                    <p class="mb-1"><strong>Phone:</strong> {{ order.mechanicSnapshot?.phone }}</p>
                    <p class="mb-1"><strong>experienceYears:</strong> {{ order.mechanicSnapshot?.experienceYears }}years
                    </p>
                </div>
            </div>
        </div>

        <!-- Machine -->
        <div class="col-md-6 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="tools p-3 align-items-center ">
                    <div class="wrapper-colors d-flex align-items-center">
                        <div class="circle">
                            <span class="red box pulse"></span>
                        </div>
                        <div class="circle">
                            <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                        </div>
                        <div class="circle">
                            <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                        </div>
                        <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
                    </div>
                </div>
                <div class="card-body">
                    <h5 class="card-title text-secondary">Machine Used</h5>
                    <p class="mb-1"><strong>Id:</strong> {{ order.machineUsed?._id }}</p>
                    <p class="mb-1"><strong>VehicleId:</strong> {{ order.machineUsed?.VehicleId }}</p>
                    <p class="mb-1"><strong>Name:</strong> {{ order.machineUsed?.name }}</p>
                    <p class="mb-1"><strong>Brand:</strong> {{ order.machineUsed?.brand }}</p>
                    <p class="mb-1"><strong>Model:</strong> {{ order.machineUsed?.model }}</p>
                    <p class="mb-1 text-success"><strong>Status:</strong> {{ order.machineUsed?.status }}</p>
                    @for (m of order.machineUsed.maintenanceLog; track $index) {
                    <p class="mb-1"><strong>PerformedBy:</strong> {{ m.performedBy }}</p>
                    <p class="mb-1"><strong>Note:</strong> {{ m.notes }}</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Services -->
    <div class="card shadow-sm mb-4">
        <div class="tools p-3 align-items-center ">
            <div class="wrapper-colors d-flex align-items-center">
                <div class="circle">
                    <span class="red box pulse"></span>
                </div>
                <div class="circle">
                    <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                </div>
                <div class="circle">
                    <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                </div>
                <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title text-secondary">Services Performed</h5>
            <ul class="list-group">
                <li *ngFor="let s of order.servicesPerformed" class="list-group-item d-flex justify-content-between">
                    <span>{{ s.serviceId?.name || s.serviceId }}</span>
                    <span class="text-success">{{ s.price | currency }}</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Parts -->
    <div class="card shadow-sm">
        <div class="tools p-3 align-items-center ">
            <div class="wrapper-colors d-flex align-items-center">
                <div class="circle">
                    <span class="red box pulse"></span>
                </div>
                <div class="circle">
                    <span class="yellow box pulse" style="animation-delay: 0.3s;"></span>
                </div>
                <div class="circle">
                    <span class="green box pulse" style="animation-delay: 0.6s;"></span>
                </div>
                <div class="skeleton dark-skeleton skeleton-title ms-3"></div>
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title text-secondary">Parts Used</h5>
            @if (order.partsUsed.length >0) {
            <ul class="list-group">
                <li *ngFor="let p of order.partsUsed" class="list-group-item d-flex justify-content-between">
                    <span>{{ p.partId?.name || p.partId }} (Qty: {{ p.quantity }})</span>
                    <span class="text-danger">{{ p.pricePerUnit | currency }}</span>
                </li>
            </ul>
            }@else {
            <p class="text-danger">No part Available</p>
            }
        </div>
    </div>
</div>